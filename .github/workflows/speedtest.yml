# .github/workflows/speedtest.yml
name: 20x Ookla Speedtest

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  speedtest:
    runs-on: ubuntu-latest

    steps:
      - name: üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ speedtest-cli –æ—Ç Ookla
        run: |
          sudo apt-get update
          sudo apt-get install -y gnupg1 curl zip
          curl -s https://packagecloud.io/install/repositories/ookla/speedtest-cli/script.deb.sh | sudo bash
          sudo apt-get install -y speedtest

      - name: üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º 20 —Ç–µ—Å—Ç–æ–≤ –ø–æ–¥—Ä—è–¥
        run: |
          mkdir -p results
          for i in $(seq -w 1 20); do
            echo "‚ñ∫ –¢–µ—Å—Ç #$i"
            speedtest -f json > results/speedtest_$i.json
          done

      - name: üì¶ –°–æ–∑–¥–∞—ë–º zip-–∞—Ä—Ö–∏–≤
        run: |
          ZIP_NAME="speedtests_$(date +%Y%m%d_%H%M%S).zip"
          zip -r "$ZIP_NAME" results
          echo "ZIP_NAME=$ZIP_NAME" >> $GITHUB_ENV

      # üÜï  –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ actions/upload-artifact@v4
      - name: ‚¨ÜÔ∏è –ó–∞–≥—Ä—É–∂–∞–µ–º –∞—Ä—Ö–∏–≤ –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç
        uses: actions/upload-artifact@v4
        with:
          artifact-name: ${{ env.ZIP_NAME }}   # üÜï –±—ã–ª–æ "name"
          path: ${{ env.ZIP_NAME }}
          retention-days: 30

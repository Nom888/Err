# .github/workflows/speedtest.yml
name: 20x Ookla Speedtest

on:
  workflow_dispatch:       # –∑–∞–ø—É—Å–∫–∞–µ–º –≤—Ä—É—á–Ω—É—é –∏–∑ –≤–∫–ª–∞–¥–∫–∏ Actions
  schedule:
    - cron: '0 */6 * * *'  # –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ (–º–æ–∂–µ—Ç–µ —É–±—Ä–∞—Ç—å)

jobs:
  speedtest:
    runs-on: ubuntu-latest

    steps:
      - name: üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ speedtest-cli –æ—Ç Ookla
        run: |
          sudo apt-get update
          sudo apt-get install -y gnupg1 curl zip
          curl -s https://packagecloud.io/install/repositories/ookla/speedtest-cli/script.deb.sh | sudo bash
          sudo apt-get install -y speedtest

      - name: üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º 20 —Ç–µ—Å—Ç–æ–≤ –ø–æ–¥—Ä—è–¥
        run: |
          mkdir -p results
          for i in $(seq -w 1 20); do
            echo "‚ñ∫ –¢–µ—Å—Ç #$i"
            # -f json = —Ñ–æ—Ä–º–∞—Ç JSON; —É–±–µ—Ä–∏—Ç–µ –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç–µ, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω text/csv
            speedtest -f json > results/speedtest_$i.json
          done

      - name: üì¶ –°–æ–∑–¥–∞—ë–º zip-–∞—Ä—Ö–∏–≤
        run: |
          ZIP_NAME="speedtests_$(date +%Y%m%d_%H%M%S).zip"
          zip -r "$ZIP_NAME" results
          echo "ZIP_NAME=$ZIP_NAME" >> $GITHUB_ENV   # —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞

      - name: ‚¨ÜÔ∏è –ó–∞–≥—Ä—É–∂–∞–µ–º –∞—Ä—Ö–∏–≤ –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç
        uses: actions/upload-artifact@v3
        with:
          name: ${{ env.ZIP_NAME }}
          path: ${{ env.ZIP_NAME }}
          retention-days: 30         # —Ö—Ä–∞–Ω–∏—Ç—å 30 –¥–Ω–µ–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
